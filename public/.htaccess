RewriteEngine On

# Handle Angular/React Router
RewriteBase /

# WordPress query URL: /pl/?page_id= → /
RewriteCond %{QUERY_STRING} (^|&)page_id=\d+(&|$)
RewriteRule ^ /? [R=301,L]

# Disable caching only when page_id is present, so rewrite can run
SetEnvIfExpr "%{QUERY_STRING} =~ /(^|&)page_id=\d+(&|$)/" NOCACHE_PAGEID=1
Header set Cache-Control "no-cache, no-store, must-revalidate" env=NOCACHE_PAGEID

# If LiteSpeed is present, also hint it explicitly (optional but helpful)
<IfModule LiteSpeed>
    Header set LSCache-Control "no-cache" env=NOCACHE_PAGEID
</IfModule>

# Team page variants
Redirect 301 /our-team/ /team

Redirect 301 /psychotherapy-in-english /counselling-psychotherapy

# Contact email path mistake
RewriteRule ^contact/contact@mindinblue\.com/?$ /contact [R=301,L]

# Old "home" slugs
Redirect 301 /home/ /
Redirect 301 /pl/home/ /

# Old service slug → new
Redirect 301 /psychotherapy-coaching-online/ /online-consultation

# Polish contact → contact
Redirect 301 /pl/kontakt/ /contact
Redirect 301 /kontakt/ /contact

# Old profile pages → team (or use 410 if you want them gone)
Redirect 301 /joanna-wronska/ /team
Redirect 301 /pl/anna/ /team
Redirect 301 /anna/ /team



# --- Strip /pl/ prefix and keep the rest ---
# /pl  or /pl/   →  /
RedirectMatch 301 ^/pl/?$ /
# /pl/anything   →  /anything   (query string preserved)
RedirectMatch 301 ^/pl/(.+)$ /$1

# Old profile/content slugs → team page
Redirect 301 /jakub-hyla/ /team
Redirect 301 /kateryna-katerynchuk/ /team
Redirect 301 /intuitive-eating/ /team

# Normalize trailing slash (skip real files/dirs)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+?)/$ /$1 [R=301,L]


RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^$ /index.html [L]
# known routes
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(team|services|contact|counselling-psychotherapy|couples-therapy|online-consultation|expat-therapy-poland)/?$ /index.html [L]


# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"

# Cache static assets
<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
</IfModule>


# --- Gzip/deflate ---

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>
